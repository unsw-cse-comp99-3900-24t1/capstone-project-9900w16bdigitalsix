package util

import (
	"encoding/base64"
	"errors"
	"os"
	"strings"
	"time"
)

// SaveBase64Image 将Base64编码的图片数据保存为文件
func SaveBase64Image(base64Data string, outputDir string) (string, string, error) {
	// 分离Base64头部信息
	idx := strings.Index(base64Data, ",")
	if idx < 0 {
		return "", "", errors.New("invalid base64 data")
	}
	data := base64Data[idx+1:]

	// 解码Base64数据
	imgData, err := base64.StdEncoding.DecodeString(data)
	if err != nil {
		return "", "", err
	}

	// 生成文件名
	filename := time.Now().Format("20060102150405") + ".png"
	savePath := outputDir + "/" + filename

	// 确保输出目录存在
	if _, err := os.Stat(outputDir); os.IsNotExist(err) {
		if err := os.Mkdir(outputDir, os.ModePerm); err != nil {
			return "", "", err
		}
	}

	// 将二进制数据写入文件
	if err := os.WriteFile(savePath, imgData, 0644); err != nil {
		return "", "", err
	}

	return filename, savePath, nil
}

// func main() {
// 	base64Image := "data:image/png;base64,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"
// 	outputDir := "../pictures"

// 	filename, _, err := SaveBase64Image(base64Image, outputDir)
// 	if err != nil {
// 		fmt.Printf("Failed to save image: %v\n", err)
// 	} else {
// 		fmt.Printf("Image saved at: %s\n", "backend/pictures/"+filename)
// 	}
// }
